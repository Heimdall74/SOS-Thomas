<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}SOS Thomas{% endblock %}</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #3b82f6;
            --secondary-color: #10b981;
            --accent-color: #f59e0b;
        }
        
        .primary-bg { background-color: var(--primary-color); }
        .secondary-bg { background-color: var(--secondary-color); }
        .accent-bg { background-color: var(--accent-color); }
        
        .icon-card {
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .icon-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        
        /* Animations pour les icônes de navigation */
        .nav-icon {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .nav-icon:hover {
            transform: scale(1.15) rotate(5deg);
            filter: brightness(1.2);
        }
        
        .nav-item {
            transition: all 0.3s ease;
        }
        
        .nav-item:hover {
            transform: translateX(5px);
        }
        
        .nav-item:hover .nav-icon {
            transform: scale(1.2) rotate(-5deg);
        }
        
        /* Animations pour les boutons du header */
        .header-btn {
            transition: all 0.2s ease;
        }
        
        .header-btn:hover {
            transform: scale(1.1);
            filter: brightness(1.1);
        }
        
        .header-btn:active {
            transform: scale(0.95);
        }
        
        /* Animation pour le timer */
        .timer-display {
            font-family: 'Courier New', monospace;
            font-size: 1.5rem;
            transition: all 0.3s ease;
        }
        
        .timer-display:hover {
            transform: scale(1.05);
            filter: brightness(1.1);
        }
        
        /* Animation pour la notification */
        .notification-dot {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
                opacity: 1;
            }
            50% {
                transform: scale(1.2);
                opacity: 0.8;
            }
        }
        
        /* Animation pour le menu utilisateur */
        .user-menu-btn {
            transition: all 0.3s ease;
        }
        
        .user-menu-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        /* Animations pour les widgets du dashboard */
        .widget-card {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .widget-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        
        .widget-icon {
            transition: all 0.3s ease;
        }
        
        .widget-card:hover .widget-icon {
            transform: scale(1.1) rotate(5deg);
        }
        
        /* Animation pour les boutons principaux */
        .btn-primary {
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(59, 130, 246, 0.3);
        }
        
        .btn-primary:active {
            transform: translateY(0);
        }
        
        .flash-messages {
            position: fixed;
            top: 80px;
            right: 20px;
            z-index: 50;
        }
        
        .flash-message {
            background-color: #10b981;
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            margin-bottom: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body class="bg-gray-50">
    <div class="min-h-screen bg-gray-50 flex">
        <!-- Bandeau latéral gauche -->
        <aside class="w-64 bg-yellow-50 border-r border-yellow-200 p-4">
            <div class="mb-8">
                <h1 class="text-xl font-bold text-indigo-600 mb-6">SOS Thomas</h1>
            </div>
            
            <!-- Navigation -->
            <nav class="space-y-2">
                <a href="{{ url_for('dashboard') }}" class="nav-item flex items-center space-x-3 p-3 rounded-lg hover:bg-yellow-100 transition-colors text-gray-700 hover:text-gray-900 {% if request.endpoint == 'dashboard' %}bg-yellow-100 text-gray-900{% endif %}">
                    <div class="nav-icon bg-gray-100 w-8 h-8 rounded-lg flex items-center justify-center">
                        <i class="fas fa-home text-gray-600 text-sm"></i>
                    </div>
                    <span class="font-medium">Dashboard</span>
                </a>

                <a href="{{ url_for('agenda') }}" class="nav-item flex items-center space-x-3 p-3 rounded-lg hover:bg-yellow-100 transition-colors text-gray-700 hover:text-gray-900 {% if request.endpoint == 'agenda' %}bg-yellow-100 text-gray-900{% endif %}">
                    <div class="nav-icon bg-blue-100 w-8 h-8 rounded-lg flex items-center justify-center">
                        <i class="fas fa-calendar-alt text-blue-600 text-sm"></i>
                    </div>
                    <span class="font-medium">Agenda</span>
                </a>

                <a href="{{ url_for('projets') }}" class="nav-item flex items-center space-x-3 p-3 rounded-lg hover:bg-yellow-100 transition-colors text-gray-700 hover:text-gray-900 {% if request.endpoint == 'projets' %}bg-yellow-100 text-gray-900{% endif %}">
                    <div class="nav-icon bg-green-100 w-8 h-8 rounded-lg flex items-center justify-center">
                        <i class="fas fa-project-diagram text-green-600 text-sm"></i>
                    </div>
                    <span class="font-medium">Projets</span>
                </a>

                <a href="{{ url_for('taches') }}" class="nav-item flex items-center space-x-3 p-3 rounded-lg hover:bg-yellow-100 transition-colors text-gray-700 hover:text-gray-900 {% if request.endpoint == 'taches' %}bg-yellow-100 text-gray-900{% endif %}">
                    <div class="nav-icon bg-yellow-100 w-8 h-8 rounded-lg flex items-center justify-center">
                        <i class="fas fa-tasks text-yellow-600 text-sm"></i>
                    </div>
                    <span class="font-medium">Tâches</span>
                </a>

                <a href="{{ url_for('notes') }}" class="nav-item flex items-center space-x-3 p-3 rounded-lg hover:bg-yellow-100 transition-colors text-gray-700 hover:text-gray-900 {% if request.endpoint == 'notes' %}bg-yellow-100 text-gray-900{% endif %}">
                    <div class="nav-icon bg-purple-100 w-8 h-8 rounded-lg flex items-center justify-center">
                        <i class="fas fa-sticky-note text-purple-600 text-sm"></i>
                    </div>
                    <span class="font-medium">Notes</span>
                </a>

                <a href="{{ url_for('comptes') }}" class="nav-item flex items-center space-x-3 p-3 rounded-lg hover:bg-yellow-100 transition-colors text-gray-700 hover:text-gray-900 {% if request.endpoint == 'comptes' %}bg-yellow-100 text-gray-900{% endif %}">
                    <div class="nav-icon bg-red-100 w-8 h-8 rounded-lg flex items-center justify-center">
                        <i class="fas fa-users text-red-600 text-sm"></i>
                    </div>
                    <span class="font-medium">Comptes</span>
                </a>

                <a href="{{ url_for('mails') }}" class="flex items-center space-x-3 p-3 rounded-lg hover:bg-yellow-100 transition-colors text-gray-700 hover:text-gray-900 {% if request.endpoint == 'mails' %}bg-yellow-100 text-gray-900{% endif %}">
                    <div class="bg-orange-100 w-8 h-8 rounded-lg flex items-center justify-center">
                        <i class="fas fa-envelope text-orange-600 text-sm"></i>
                    </div>
                    <span class="font-medium">Mails</span>
                </a>

                <a href="{{ url_for('medias') }}" class="flex items-center space-x-3 p-3 rounded-lg hover:bg-yellow-100 transition-colors text-gray-700 hover:text-gray-900 {% if request.endpoint == 'medias' %}bg-yellow-100 text-gray-900{% endif %}">
                    <div class="bg-pink-100 w-8 h-8 rounded-lg flex items-center justify-center">
                        <i class="fas fa-photo-video text-pink-600 text-sm"></i>
                    </div>
                    <span class="font-medium">Médias</span>
                </a>

                <a href="{{ url_for('reunion') }}" class="flex items-center space-x-3 p-3 rounded-lg hover:bg-yellow-100 transition-colors text-gray-700 hover:text-gray-900 {% if request.endpoint == 'reunion' %}bg-yellow-100 text-gray-900{% endif %}">
                    <div class="bg-teal-100 w-8 h-8 rounded-lg flex items-center justify-center">
                        <i class="fas fa-users-cog text-teal-600 text-sm"></i>
                    </div>
                    <span class="font-medium">Réunion</span>
                </a>

                <a href="{{ url_for('musique') }}" class="flex items-center space-x-3 p-3 rounded-lg hover:bg-yellow-100 transition-colors text-gray-700 hover:text-gray-900 {% if request.endpoint == 'musique' %}bg-yellow-100 text-gray-900{% endif %}">
                    <div class="bg-green-100 w-8 h-8 rounded-lg flex items-center justify-center">
                        <i class="fas fa-music text-green-600 text-sm"></i>
                    </div>
                    <span class="font-medium">Musique</span>
                </a>

                <a href="{{ url_for('liens') }}" class="flex items-center space-x-3 p-3 rounded-lg hover:bg-yellow-100 transition-colors text-gray-700 hover:text-gray-900 {% if request.endpoint == 'liens' %}bg-yellow-100 text-gray-900{% endif %}">
                    <div class="bg-indigo-100 w-8 h-8 rounded-lg flex items-center justify-center">
                        <i class="fas fa-link text-indigo-600 text-sm"></i>
                    </div>
                    <span class="font-medium">Liens</span>
                </a>
            </nav>
        </aside>

        <!-- Contenu principal -->
        <main class="flex-1">
            <!-- Header -->
            <header class="bg-white shadow-sm border-b border-gray-200">
                <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                    <div class="flex justify-between items-center h-16">
                        <div class="flex items-center">
                            <h2 class="text-2xl font-bold text-gray-800">{% block page_title %}SOS Thomas{% endblock %}</h2>
                        </div>
                        <div class="flex items-center space-x-4">
                            <button onclick="toggleTheme()" class="header-btn p-2 rounded-lg hover:bg-gray-100">
                                <i class="fas fa-palette"></i>
                            </button>
                            <div id="timer" class="timer-display text-gray-700">00:00:00</div>
                            <button class="header-btn relative p-2 text-gray-600 hover:text-gray-900">
                                <i class="fas fa-bell text-xl"></i>
                                <span class="notification-dot absolute top-1 right-1 w-2 h-2 bg-red-500 rounded-full"></span>
                            </button>
                            
                            <!-- Menu utilisateur -->
                            <div class="relative">
                                <a href="{{ url_for('profile') }}" class="user-menu-btn flex items-center space-x-2 p-2 text-gray-600 hover:text-gray-900 rounded-lg hover:bg-gray-100">
                                    <i class="fas fa-user-circle text-xl"></i>
                                    <span class="text-sm font-medium">{{ session.username }}</span>
                                    <i class="fas fa-chevron-down text-xs"></i>
                                </a>
                                
                                <!-- Dropdown menu -->
                                <div id="user-menu" class="hidden absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg border border-gray-200 z-50">
                                    <div class="px-4 py-3 border-b border-gray-200">
                                        <p class="text-sm font-medium text-gray-900">{{ session.username }}</p>
                                        <p class="text-xs text-gray-500">Connecté</p>
                                    </div>
                                    <div class="py-2">
                                        <a href="{{ url_for('profile') }}" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                                            <i class="fas fa-user-edit mr-2"></i>Profil
                                        </a>
                                        <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                                            <i class="fas fa-cog mr-2"></i>Paramètres
                                        </a>
                                        <div class="border-t border-gray-200 mt-2 pt-2">
                                            <a href="{{ url_for('logout') }}" class="block px-4 py-2 text-sm text-red-600 hover:bg-red-50">
                                                <i class="fas fa-sign-out-alt mr-2"></i>Déconnexion
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </header>

            <!-- Flash Messages -->
            {% with messages = get_flashed_messages() %}
                {% if messages %}
                    <div class="flash-messages">
                        {% for message in messages %}
                            <div class="flash-message">{{ message }}</div>
                        {% endfor %}
                    </div>
                {% endif %}
            {% endwith %}

            <!-- Main Content -->
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
                {% block content %}{% endblock %}
            </div>
        </main>
    </div>

    <script>
        // Timer
        let seconds = 0;
        setInterval(() => {
            seconds++;
            const hours = Math.floor(seconds / 3600);
            const minutes = Math.floor((seconds % 3600) / 60);
            const secs = seconds % 60;
            document.getElementById('timer').textContent = 
                `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }, 1000);

        // User Menu
        function toggleUserMenu(event) {
            if (event) {
                event.preventDefault(); // Empêche la navigation si on clique sur l'icône
            }
            const menu = document.getElementById('user-menu');
            menu.classList.toggle('hidden');
        }

        // Fermer le menu utilisateur en cliquant ailleurs
        document.addEventListener('click', function(event) {
            const userMenu = document.getElementById('user-menu');
            const userButton = event.target.closest('.user-menu-btn');
            
            if (!userButton && !userMenu.contains(event.target)) {
                userMenu.classList.add('hidden');
            }
        });

        // Gérer le clic sur l'icône utilisateur pour ouvrir le menu
        document.addEventListener('DOMContentLoaded', function() {
            const userMenuBtn = document.querySelector('.user-menu-btn');
            if (userMenuBtn) {
                userMenuBtn.addEventListener('click', function(event) {
                    // Si on clique sur l'icône ou le nom d'utilisateur, ouvrir le menu
                    if (event.target.closest('i') || event.target.closest('span')) {
                        toggleUserMenu(event);
                    }
                    // Si on clique sur le chevron, ouvrir le menu
                    else if (event.target.closest('.fa-chevron-down')) {
                        toggleUserMenu(event);
                    }
                    // Sinon, laisser la navigation normale vers le profil
                });
            }
        });

        // Theme
        function toggleTheme() {
            const colors = [
                { primary: '#3b82f6', secondary: '#10b981', accent: '#f59e0b' },
                { primary: '#8b5cf6', secondary: '#ec4899', accent: '#f97316' },
                { primary: '#06b6d4', secondary: '#84cc16', accent: '#f43f5e' },
                { primary: '#6366f1', secondary: '#14b8a6', accent: '#eab308' }
            ];
            
            const randomColor = colors[Math.floor(Math.random() * colors.length)];
            document.documentElement.style.setProperty('--primary-color', randomColor.primary);
            document.documentElement.style.setProperty('--secondary-color', randomColor.secondary);
            document.documentElement.style.setProperty('--accent-color', randomColor.accent);
        }

        // Auto-hide flash messages
        setTimeout(() => {
            const flashMessages = document.querySelector('.flash-messages');
            if (flashMessages) {
                flashMessages.style.display = 'none';
            }
        }, 5000);
    </script>
    
    {% block scripts %}{% endblock %}
</body>
</html>
